repos:
  - repo: local
    hooks:
      - id: black
        name: black (formatting)
        language: system
        entry: black --check --quiet
        types: [python]

      - id: ruff
        name: ruff (linting + import sorting)
        language: system
        entry: ruff check --fix
        types: [python]

      - id: mypy
        name: mypy (type checking)
        language: system
        entry: mypy --cache-dir /dev/null
        types: [python]
        pass_filenames: false
        args: [orchard/]

      - id: bandit
        name: bandit (security scan)
        language: system
        entry: bandit -c pyproject.toml -r
        types: [python]

      - id: test-coverage
        name: test suite + 100% coverage
        language: system
        entry: pytest tests/ --cov=orchard --cov-fail-under=100 -x -q --tb=short --no-header
        pass_filenames: false
        always_run: true

      - id: no-env-files
        name: block .env files
        language: fail
        entry: ".env files must not be committed"
        files: '\.env($|\.)'

      - id: nbstripout
        name: strip notebook outputs
        language: system
        entry: python scripts/strip_notebook_outputs.py
        types: [jupyter]

      - id: git-cliff
        name: generate changelog
        language: system
        entry: bash scripts/update-changelog.sh
        stages: [pre-commit]
        always_run: true
        pass_filenames: false

      - id: pre-push-quality-gate
        name: pre-push quality gate
        language: system
        entry: bash -c 'ruff check orchard/ tests/ && bandit -c pyproject.toml -r orchard/ && mypy orchard/'
        pass_filenames: false
        always_run: true
        stages: [pre-push]
